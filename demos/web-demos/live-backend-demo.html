<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShaydZ AVMo - Live Backend Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #007AFF, #5AC8FA);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 18px;
            opacity: 0.9;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .status-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .status-card:hover {
            transform: translateY(-5px);
        }

        .status-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }

        .status-icon.auth { background: linear-gradient(135deg, #FF6B6B, #FF8E53); }
        .status-icon.catalog { background: linear-gradient(135deg, #4ECDC4, #44A08D); }
        .status-icon.vm { background: linear-gradient(135deg, #A8E6CF, #7FCDCD); }
        .status-icon.gateway { background: linear-gradient(135deg, #D4A5FF, #9A8AFF); }

        .status-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        .status-dot.error {
            background: #dc3545;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .metrics {
            font-size: 14px;
            color: #666;
        }

        .data-section {
            padding: 30px;
        }

        .data-section h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .data-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .data-tab {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .data-tab.active {
            border-bottom-color: #007AFF;
            color: #007AFF;
        }

        .data-content {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            min-height: 300px;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .data-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .data-card h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .data-card p {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .auth-demo {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #eee;
        }

        .auth-form {
            display: flex;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
        }

        .auth-form input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .auth-form button {
            padding: 10px 20px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .auth-result {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .success {
            color: #155724;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ ShaydZ AVMo - Live Backend Demo</h1>
            <p>Real-time integration with your running backend services</p>
        </div>

        <div class="status-grid">
            <div class="status-card">
                <div class="status-header">
                    <div class="status-icon auth">üîê</div>
                    <div class="status-info">
                        <h3>Auth Service</h3>
                        <div class="status-indicator">
                            <div class="status-dot" id="auth-status"></div>
                            <span id="auth-text">Checking...</span>
                        </div>
                        <div class="metrics" id="auth-metrics">Port: 8081</div>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <div class="status-header">
                    <div class="status-icon catalog">üì±</div>
                    <div class="status-info">
                        <h3>App Catalog</h3>
                        <div class="status-indicator">
                            <div class="status-dot" id="catalog-status"></div>
                            <span id="catalog-text">Checking...</span>
                        </div>
                        <div class="metrics" id="catalog-metrics">Port: 8083</div>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <div class="status-header">
                    <div class="status-icon vm">üñ•Ô∏è</div>
                    <div class="status-info">
                        <h3>VM Orchestrator</h3>
                        <div class="status-indicator">
                            <div class="status-dot" id="vm-status"></div>
                            <span id="vm-text">Checking...</span>
                        </div>
                        <div class="metrics" id="vm-metrics">Port: 8082</div>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <div class="status-header">
                    <div class="status-icon gateway">üåê</div>
                    <div class="status-info">
                        <h3>API Gateway</h3>
                        <div class="status-indicator">
                            <div class="status-dot" id="gateway-status"></div>
                            <span id="gateway-text">Checking...</span>
                        </div>
                        <div class="metrics" id="gateway-metrics">Port: 8080</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="data-section">
            <h2>Live Backend Data</h2>
            
            <div class="data-tabs">
                <button class="data-tab active" onclick="showTab('auth')">Authentication</button>
                <button class="data-tab" onclick="showTab('apps')">App Catalog</button>
                <button class="data-tab" onclick="showTab('vms')">Virtual Machines</button>
            </div>

            <div class="data-content">
                <!-- Authentication Tab -->
                <div class="tab-content active" id="auth-tab">
                    <div class="auth-demo">
                        <h3>Test Authentication</h3>
                        <div class="auth-form">
                            <input type="text" id="test-username" placeholder="Username" value="demo">
                            <input type="password" id="test-password" placeholder="Password" value="password">
                            <button onclick="testAuth()">Login</button>
                        </div>
                        <div class="auth-result" id="auth-result">Click "Login" to test authentication...</div>
                    </div>
                </div>

                <!-- Apps Tab -->
                <div class="tab-content" id="apps-tab">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading app catalog...</p>
                    </div>
                    <div class="data-grid" id="apps-grid"></div>
                </div>

                <!-- VMs Tab -->
                <div class="tab-content" id="vms-tab">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading virtual machines...</p>
                    </div>
                    <div class="data-grid" id="vms-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let authToken = null;

        // Check service health
        async function checkServiceHealth() {
            const services = [
                { name: 'auth', url: '/health', port: 8081 },
                { name: 'catalog', url: '/health', port: 8083 },
                { name: 'vm', url: '/health', port: 8082 },
                { name: 'gateway', url: '/health', port: 8080 }
            ];

            for (const service of services) {
                try {
                    const start = Date.now();
                    const response = await fetch(service.url);
                    const duration = Date.now() - start;
                    
                    if (response.ok) {
                        updateServiceStatus(service.name, 'online', `Response: ${duration}ms`);
                    } else {
                        updateServiceStatus(service.name, 'error', `HTTP ${response.status}`);
                    }
                } catch (error) {
                    updateServiceStatus(service.name, 'error', 'Connection failed');
                }
            }
        }

        function updateServiceStatus(service, status, message) {
            const statusDot = document.getElementById(`${service}-status`);
            const statusText = document.getElementById(`${service}-text`);
            const metricsText = document.getElementById(`${service}-metrics`);

            if (status === 'online') {
                statusDot.className = 'status-dot';
                statusText.textContent = 'Online';
                metricsText.textContent += ` ‚Ä¢ ${message}`;
            } else {
                statusDot.className = 'status-dot error';
                statusText.textContent = 'Offline';
                metricsText.textContent += ` ‚Ä¢ ${message}`;
            }
        }

        // Test authentication
        async function testAuth() {
            const username = document.getElementById('test-username').value;
            const password = document.getElementById('test-password').value;
            const resultDiv = document.getElementById('auth-result');

            resultDiv.innerHTML = 'Authenticating...';

            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    resultDiv.innerHTML = `<div class="success">
                        <strong>‚úÖ Authentication Successful!</strong><br>
                        Token: ${data.token.substring(0, 50)}...<br>
                        User: ${data.user.username} (${data.user.id})
                    </div>`;
                    
                    // Load other data now that we're authenticated
                    loadApps();
                    loadVMs();
                } else {
                    resultDiv.innerHTML = `<div class="error">
                        <strong>‚ùå Authentication Failed</strong><br>
                        ${data.message || 'Invalid credentials'}
                    </div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">
                    <strong>‚ùå Connection Error</strong><br>
                    ${error.message}
                </div>`;
            }
        }

        // Load apps
        async function loadApps() {
            const appsGrid = document.getElementById('apps-grid');
            
            if (!authToken) {
                appsGrid.innerHTML = '<div class="error">Please authenticate first</div>';
                return;
            }

            try {
                const response = await fetch('/apps', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const apps = await response.json();
                    appsGrid.innerHTML = '';
                    
                    apps.forEach(app => {
                        const appCard = document.createElement('div');
                        appCard.className = 'data-card';
                        appCard.innerHTML = `
                            <h4>${app.name}</h4>
                            <p><strong>Category:</strong> ${app.category}</p>
                            <p><strong>Version:</strong> ${app.version}</p>
                            <p><strong>Status:</strong> ${app.isInstalled ? '‚úÖ Installed' : '‚è≥ Available'}</p>
                            <p>${app.description}</p>
                        `;
                        appsGrid.appendChild(appCard);
                    });
                } else {
                    appsGrid.innerHTML = '<div class="error">Failed to load apps</div>';
                }
            } catch (error) {
                appsGrid.innerHTML = `<div class="error">Connection error: ${error.message}</div>`;
            }
        }

        // Load VMs
        async function loadVMs() {
            const vmsGrid = document.getElementById('vms-grid');
            
            if (!authToken) {
                vmsGrid.innerHTML = '<div class="error">Please authenticate first</div>';
                return;
            }

            try {
                const response = await fetch('/vms', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const vms = await response.json();
                    vmsGrid.innerHTML = '';
                    
                    vms.forEach(vm => {
                        const vmCard = document.createElement('div');
                        vmCard.className = 'data-card';
                        vmCard.innerHTML = `
                            <h4>${vm.name}</h4>
                            <p><strong>Status:</strong> ${vm.status === 'RUNNING' ? 'üü¢' : 'üî¥'} ${vm.status}</p>
                            <p><strong>CPU:</strong> ${vm.cpuCores} cores</p>
                            <p><strong>RAM:</strong> ${vm.ramMB}MB</p>
                            <p><strong>Storage:</strong> ${vm.diskGB}GB</p>
                        `;
                        vmsGrid.appendChild(vmCard);
                    });
                } else {
                    vmsGrid.innerHTML = '<div class="error">Failed to load VMs</div>';
                }
            } catch (error) {
                vmsGrid.innerHTML = `<div class="error">Connection error: ${error.message}</div>`;
            }
        }

        // Show tab
        function showTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.data-tab').forEach(tab => tab.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // Load data if needed
            if (tabName === 'apps' && authToken) {
                loadApps();
            } else if (tabName === 'vms' && authToken) {
                loadVMs();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ShaydZ AVMo Live Demo Initialized');
            checkServiceHealth();
            
            // Auto-refresh service status every 30 seconds
            setInterval(checkServiceHealth, 30000);
        });
    </script>
</body>
</html>
